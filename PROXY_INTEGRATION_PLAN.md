# üéØ –ü–õ–ê–ù –ë–ï–ó–û–ü–ê–°–ù–û–ô –ò–ù–¢–ï–ì–†–ê–¶–ò–ò PROXY

## üìã –¶–ï–õ–¨
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—á—É—é –ø—Ä–æ–∫—Å–∏ –ª–æ–≥–∏–∫—É –∏–∑ BrowserManager –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏.

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ (–ù–ï –¢–†–û–ì–ê–ï–ú):
- `BrowserManager` –≤ —Ç–µ—Å—Ç–∞—Ö 
- `test_complete_automation.py` - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–µ–∑ –ø—Ä–æ–∫—Å–∏
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
- `MultiTransferAutomation` —Å –ø—Ä–æ–∫—Å–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ
- `ERR_SOCKS_CONNECTION_FAILED` –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SOCKS5

### üîë –ö–û–†–ù–ï–í–´–ï –ü–†–ò–ß–ò–ù–´:
1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è**: BrowserManager vs MultiTransferAutomation
2. **–†–∞–∑–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –æ–±—ä–µ–∫—Ç—ã**: ProxyInfo vs dict
3. **–ü–µ—Ä–µ—É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ**: 7 –ø—Ä–æ–∫—Å–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å–æ–∑–¥–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

## üõ°Ô∏è –°–¢–†–ê–¢–ï–ì–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–ô –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### –ü–û–î–•–û–î: "–î–û–ë–ê–í–õ–ï–ù–ò–ï –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–Ø"

1. **–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–π –∫–æ–¥** - –≤—Å—è —Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π
2. **–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –ø—É—Ç—å** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å BrowserManager  
3. **–§–ª–∞–≥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è** - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞
4. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üìù –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠–¢–ê–ü 1: –ü–û–î–ì–û–¢–û–í–ö–ê (5 –º–∏–Ω)
```bash
# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
cp core/services/payment_service.py core/services/payment_service.py.backup
cp main.py main.py.backup
```

### –≠–¢–ê–ü 2: –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–ì–û –ö–û–î–ê (15 –º–∏–Ω)

#### –í `core/services/payment_service.py`:
```python
class PaymentService:
    def __init__(self, config, proxy_manager=None, browser_manager_factory=None):
        # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ù–ï –ú–ï–ù–Ø–ï–ú
        self.config = config
        self.proxy_manager = proxy_manager
        # –î–û–ë–ê–í–õ–Ø–ï–ú –Ω–æ–≤—É—é –æ–ø—Ü–∏—é
        self.browser_manager_factory = browser_manager_factory
        
    async def create_payment(self, ...):
        # –î–û–ë–ê–í–õ–Ø–ï–ú –ø—Ä–æ–≤–µ—Ä–∫—É —Ñ–ª–∞–≥–∞
        use_browser_manager = os.getenv('USE_BROWSER_MANAGER', 'false') == 'true'
        
        if use_browser_manager and self.browser_manager_factory:
            return await self._create_payment_with_browser_manager(...)
        else:
            # –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î - –ù–ï –ú–ï–ù–Ø–ï–ú!
            return await self._create_payment_legacy(...)
    
    async def _create_payment_legacy(self, ...):
        # –í–°–Ø –¢–ï–ö–£–©–ê–Ø –õ–û–ì–ò–ö–ê –ü–ï–†–ï–ù–û–°–ò–¢–°–Ø –°–Æ–î–ê –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô
        automation = MultiTransferAutomation(proxy=proxy, config=self.config.to_dict())
        # ... –≤–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
        
    async def _create_payment_with_browser_manager(self, ...):
        # –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê - –ö–û–ü–ò–Ø –ò–ó –¢–ï–°–¢–û–í
        browser_manager = self.browser_manager_factory(self.config, proxy_manager=self.proxy_manager)
        async with browser_manager:
            success = await browser_manager.start_browser(use_proxy=True)
            # ... –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É –∏–∑ —Ç–µ—Å—Ç–æ–≤
```

#### –í `main.py`:
```python
# –î–û–ë–ê–í–õ–Ø–ï–ú –∏–º–ø–æ—Ä—Ç
from web.browser.manager import BrowserManager

async def main():
    # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ù–ï –ú–ï–ù–Ø–ï–ú
    config = Config()
    proxy_manager = ProxyManager(config.data)
    
    # –î–û–ë–ê–í–õ–Ø–ï–ú —Ñ–∞–±—Ä–∏–∫—É –¥–ª—è BrowserManager
    def browser_manager_factory(config, proxy_manager):
        browser_config = {
            'headless': True,
            'window_size': '1920,1080',
            'implicit_wait': 10,
            'page_load_timeout': 60
        }
        return BrowserManager(browser_config, proxy_manager=proxy_manager)
    
    payment_service = PaymentService(
        config, 
        proxy_manager=proxy_manager,
        browser_manager_factory=browser_manager_factory  # –î–û–ë–ê–í–õ–Ø–ï–ú
    )
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –ù–ï –ú–ï–ù–Ø–ï–ú
```

### –≠–¢–ê–ü 3: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (10 –º–∏–Ω)

#### –¢–µ—Å—Ç 1: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫ - –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ
python main.py
# –í Telegram: /payment 1000
```

#### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É
```bash
# –ó–∞–ø—É—Å–∫ —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π
USE_BROWSER_MANAGER=true python main.py  
# –í Telegram: /payment 1000
```

#### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–µ—Å—Ç—ã –Ω–µ —Å–ª–æ–º–∞–ª–∏—Å—å
```bash
PYTHONPATH=. python3 tests/automation/test_complete_automation.py
```

### –≠–¢–ê–ü 4: –û–¢–ö–ê–¢ (1 –º–∏–Ω –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–∞—Ç
cp core/services/payment_service.py.backup core/services/payment_service.py
cp main.py.backup main.py
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –∏–∑ —Ç–µ—Å—Ç–æ–≤:
1. **–°–æ–∑–¥–∞–Ω–∏–µ BrowserManager** - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ —Ç–µ—Å—Ç–∞—Ö
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ browser_manager.driver** - –≤–º–µ—Å—Ç–æ automation.driver
3. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏** - –∏–∑ test_complete_automation.py
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç PaymentService

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:
```python
# –í–º–µ—Å—Ç–æ:
automation = MultiTransferAutomation(proxy=proxy, config=config)
result = await automation.create_payment(data)

# –ò—Å–ø–æ–ª—å–∑—É–µ–º:
browser_manager = BrowserManager(config, proxy_manager=proxy_manager)
async with browser_manager:
    success = await browser_manager.start_browser(use_proxy=True)
    if success:
        # –í—ã–ø–æ–ª–Ω—è–µ–º —Ç–µ –∂–µ —à–∞–≥–∏ —á—Ç–æ –≤ —Ç–µ—Å—Ç–∞—Ö
        result = await self._run_automation_steps(browser_manager.driver, data)
```

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–û–ú–ï–ù–¢–´

1. **–ù–ï –£–î–ê–õ–Ø–ï–ú —Å—Ç–∞—Ä—ã–π –∫–æ–¥** - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤ _create_payment_legacy
2. **–ù–ï –ú–ï–ù–Ø–ï–ú —Ç–µ—Å—Ç—ã** - –æ–Ω–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ
3. **–ù–ï –ú–ï–ù–Ø–ï–ú BrowserManager** - –æ–Ω —Ä–∞–±–æ—á–∏–π
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±–∞ –ø—É—Ç–∏** - —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å

## üéØ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

### ‚úÖ –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞:
- `/payment 1000` —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ `USE_BROWSER_MANAGER=true`
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### ‚úÖ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:
- `/payment 1000` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `USE_BROWSER_MANAGER=true`
- –ù–ï–¢ –æ—à–∏–±–∫–∏ `ERR_SOCKS_CONNECTION_FAILED`
- –ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –Ω–µ–º–µ—Ü–∫–∏–π SOCKS5
- –í—Å–µ 11 —à–∞–≥–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

## üìû –ü–õ–ê–ù –û–¢–ö–ê–¢–ê

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –∏–¥–µ—Ç –Ω–µ —Ç–∞–∫:
1. `unset USE_BROWSER_MANAGER` - –æ—Ç–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É
2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã –∏–∑ backup
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç
4. –í—Å–µ –≤–µ—Ä–Ω–µ—Ç—Å—è –∫–∞–∫ –±—ã–ª–æ

---

**–ì–õ–ê–í–ù–´–ô –ü–†–ò–ù–¶–ò–ü: –î–û–ë–ê–í–õ–Ø–ï–ú, –ù–ï –õ–û–ú–ê–ï–ú!**